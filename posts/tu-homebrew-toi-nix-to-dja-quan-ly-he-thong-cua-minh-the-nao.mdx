---
title: T·ª´ Homebrew t·ªõi Nix, t·ªõ ƒë√£ qu·∫£n l√Ω h·ªá th·ªëng c·ªßa m√¨nh th·∫ø n√†o?
tags: 
  - fctc
  - nix
  - macos
  - linux
date: 2024-03-16
excerpt: T·ªõ s·∫Ω chia s·∫ª v·ªÅ c√°ch m√¨nh qu·∫£n l√Ω h·ªá th·ªëng l·∫≠p tr√¨nh c·ªßa m√¨nh, t·ª´ m·ªôt h·ªá th·ªëng ‚Äúb·ª´a b√£i‚Äù ch·ªâ c√≥ homebrew, t·ªõi m·ªôt h·ªá th·ªëng t·ªõ n·∫Øm ho√†n to√†n quy·ªÅn b·∫±ng Nix nh√© üòΩ
image: /images/c9347c80-7b49-11e9-972e-03413da7be7a.png
category: Nix
author: { name: Nghia Tran, image: /images/authors/nghia-tran.jpeg }
---
Ch√†o m·ªçi ng∆∞·ªùi, trong b√†i sharing n√†y, t·ªõ s·∫Ω chia s·∫ª v·ªÅ c√°ch m√¨nh qu·∫£n l√Ω h·ªá th·ªëng l·∫≠p tr√¨nh c·ªßa m√¨nh, t·ª´ m·ªôt h·ªá th·ªëng ‚Äúb·ª´a b√£i‚Äù ch·ªâ c√≥ homebrew, t·ªõi m·ªôt h·ªá th·ªëng t·ªõ n·∫Øm ho√†n to√†n quy·ªÅn b·∫±ng Nix nh√© üòΩ

## 1. ·ª¶a r·ªìi Nix l√† g√¨??

Theo th√¥ng tin t·ªõ t√¨m hi·ªÉu ƒë∆∞·ª£c, th√¨ Nix l√† m·ªôt tr√¨nh qu·∫£n l√Ω c√°c g√≥i c·ªßa h·ªá th·ªëng, kh√°c v·ªõi c√°c tr√¨nh qu·∫£n l√Ω package kh√°c (nh∆∞ apt hay homebrew), th√¨ Nix s·∫Ω kh√¥ng ch·ªâ gi√∫p c·∫≠u qu·∫£n l√Ω c√°c g√≥i nh∆∞ apt hay homebrew, m√† Nix c√≤n gi√∫p c·∫≠u qu·∫£n l√Ω ƒë∆∞·ª£c to√†n b·ªô c·∫•u h√¨nh c·ªßa c√°c g√≥i trong h·ªá th·ªëng.

H√£y c·ª© t∆∞·ªüng t∆∞·ª£ng l√∫c c·∫≠u v·ª´a c·∫≠p nh·∫≠t h·ªá ƒëi·ªÅu h√†nh xong, r·ªìi c√≥ m·ªôt l·ªói b·∫•t ng·ªù x·∫£y ra, ch√≠nh c·∫≠u ph·∫£i ng·ªìi l·∫°i ƒë·ªÉ c·∫•u h√¨nh l·∫°i c√°c package sao cho ƒë√∫ng v·ªõi c√° nh√¢n c·ªßa m√¨nh, ƒë·ªëi v·ªõi m√¨nh, th√¨ vi·ªác ƒë√≥ kh√° t·ªën th·ªùi gian, m√¨nh c√≥ th·ªÉ d√†nh th·ªùi gian ƒë√≥ ƒë·ªÉ h·ªçc t·∫≠p v√† code, ƒë√∫ng kh√¥ng n√® üòΩ

Nix s·∫Ω gi√∫p c·∫≠u trong vi·ªác n√†y, thay v√¨ c√†i c√°c package th·ªß c√¥ng b·∫±ng tay v√† pull c·∫•u h√¨nh v·ªÅ (dotfiles ho·∫∑c Stow c·ªßa GNU), th√¨ ch√∫ng ta c√≥ th·ªÉ vi·∫øt th√†nh m·ªôt file c·∫•u h√¨nh, ƒë·ªÉ d√πng m·ªói khi h·ªá th·ªëng x·∫£y ra l·ªói, v√† c·∫≠u ph·∫£i c√†i ƒë·∫∑t l·∫°i h·∫øt h·ªá ƒëi·ªÅu h√†nh :( 

### 1.2. Nh·ªØng ai n√™n d√πng Nix?

ƒê·ªëi v·ªõi t·ªõ, b·∫£n th√¢n t·ªõ l√† m·ªôt ng∆∞·ªùi lu√¥n t√¨m ƒë·∫øn nh·ªØng c√¥ng ngh·ªá (ph·∫ßn m·ªÅm) m·ªõi nh·∫•t n√™n s·∫Ω s·ª≠ d·ª•ng b·∫£n beta tr√™n t·∫•t c·∫£ c√°c thi·∫øt b·ªã c·ªßa m√¨nh. Tuy nhi√™n, m·ªôt ƒëi·ªÉm tr·ª´ c·ªßa b·∫£n beta ch√≠nh l√† vi·ªác n√≥ c√≥ th·ªÉ h·ªèng m·ªôt c√°ch d·ªÖ d√†ng, l√∫c ƒë·∫•y, t·ªõ s·∫Ω ph·∫£i build h·∫øt l·∫°i h·ªá th·ªëng ƒë·ªÉ ph√π h·ª£p v·ªõi c·∫•u h√¨nh c√° nh√¢n c·ªßa m√¨nh.

Nix ch·ªß y·∫øu nh·∫Øm ƒë·∫øn nh·ªØng ng∆∞·ªùi c·∫ßn kh·∫£ nƒÉng t√°i t·∫°o v√† build package t·ª´ scratch, v√† c·∫ßn m·ªôt package c√≥ th·ªÅ c√†i ƒë·∫∑t ƒë∆∞·ª£c nhi·ªÅu version song song v·ªõi nhau.

### 1.3. ‚ÄúH·ªá sinh th√°i Nix‚Äù

ƒê·ªçc xong ph·∫ßn title, th√¨ m√¨nh nghƒ© c≈©ng s·∫Ω c√≥ nhi·ªÅu b·∫°n li√™n t∆∞·ªüng ƒë·∫øn h·ªá sinh th√°i c·ªßa Apple, ƒëi·ªÅu ƒë√≥ c≈©ng g·∫ßn gi·ªëng nh∆∞ Nix, ngo√†i nh·ªØng concept m√¨nh v·ª´a li·ªát k√™ ·ªü tr√™n, th√¨ Nix c≈©ng c√≥ th·ªÉ gi√∫p b·∫°n th·ª±c hi·ªán nh·ªØng build release c√≥ th·ªÉ t√°i t·∫°o ƒë∆∞·ª£c, ƒëi·ªÅu n√†y c≈©ng r·∫•t gi·ªëng v·ªõi ng√†nh devops m√† t·ªõ ƒëang theo.

V·ªõi Nix, ch√∫ng ta s·∫Ω ch·ªß y·∫øu t·∫≠p trung v√†o hai nh√°nh sau:

- NixOS: ƒê√¢y l√† m·ªôt distro Linux, nh∆∞ng kh√°c v·ªõi c√°c distro tr√™n th·ªã tr∆∞·ªùng, NixOS s·ª≠ d·ª•ng package manager ri√™ng c·ªßa n√≥ - NixOS. Vi·ªác c·∫•u h√¨nh m·ªçi th·ª© ch·ªâ di·ªÖn ra trong m·ªôt file trong h·ªá th·ªëng (`/etc/nixos/configuration.nix`).
    
    Kh√°c v·ªõi c√°c distro s·ª≠ d·ª•ng systemd, NixOS s·∫Ω gi√∫p b·∫°n c·∫•u h√¨nh to√†n b·ªô h·ªá th·ªëng trong file ƒë∆∞·ª£c n√™u tr√™n, l·∫•y v√≠ d·ª• khi ƒë·∫∑t hostname cho h·ªá th·ªëng, thay v√¨ ph·∫£i th·ª±c hi·ªán vi·ªác s·ª≠ d·ª•ng `echo emladevops > /etc/hostname`, th√¨ ƒë·ªëi v·ªõi Nix, b·∫°n ch·ªâ c·∫ßn ƒë·∫∑t gi√° tr·ªã cho bi√™n `hostname` trong file tr√™n m√† th√¥i.
    
- Nixpkgs: C≈©ng gi·ªëng nh∆∞ c√°c mirror c·ªßa distro Linux kh√°c, Nixpkgs l√† m·ªôt package gallery bao g·ªìm c√°c g√≥i ph·∫ßn m·ªÅm ƒë∆∞·ª£c vi·∫øt b·∫±ng Nix, ƒëi·ªÅu n√†y s·∫Ω gi√∫p c√°c b·∫°n c√≥ th·ªÉ thay ƒë·ªïi package ƒë∆°n gi·∫£n h∆°n (Hydra v√† Hackage). Nixpkgs c√≤n h·ªó tr·ª£ r·∫•t m·∫°nh m·∫Ω vi·ªác cross compilation (v√≠ d·ª•: compile ch√©o `bash`  qua h·ªá ƒëi·ªÅu h√†nh Windows b·∫±ng `nixpkgs.pkgsCross.mingwW64.bash`

Nix c√≤n t√≠ch h·ª£p s√¢u v·ªõi nh·ªØng service hi·ªán ƒëang c√≥ nh∆∞ `neovim` hay `nginx` , t·ªõ s·∫Ω l·∫•y v√≠ d·ª• nh√©:

Thay v√¨ vi·ªác c·∫≠u c·∫•u h√¨nh m·ªôt site trong nginx ki·ªÉu `/etc/nginx/site-available` , r·ªìi vi·∫øt th·∫≠t nhi·ªÅu code ƒë·ªÉ define ƒë∆∞·ª£c trang web v√† server, th√¨ trong Nix, ch√∫ng ta ch·ªâ c·∫ßn:

```jsx
services.nginx.enable = true;
services.nginx.virtualHosts."tleoj.edu.vn".webRoot = "tleoj.edu.vn";
```

B·∫°n th·∫•y vi·ªác n√†y ti·ªán l·ª£i h∆°n nhi·ªÅu ƒë√∫ng kh√¥ng?

## 2. Con ƒë∆∞·ªùng c·ªßa t·ªõ t·ª´ Homebrew sang Nix

B·∫£n th√¢n t·ªõ ƒëang s·ª≠ d·ª•ng hai h·ªá ƒëi·ªÅu h√†nh kh√°c nhau ƒë·ªÉ ph·ª•c v·ª• cho vi·ªác l·∫≠p tr√¨nh c·ªßa m√¨nh (macOS v√† Linux), m√† t·ªõ nh·∫≠n ra ƒë∆∞·ª£c vi·ªác setup c√°c m√¥i tr∆∞·ªùng nhi·ªÅu l·∫ßn m·ªói khi c√†i ƒë·∫∑t l·∫°i th·ª±c s·ª± r·∫•t t·ªën th·ªùi gian c·ªßa m√¨nh, v·∫≠y n√™n t·ªõ ƒë√£ b·∫Øt ƒë·∫ßu t√¨m hi·ªÉu v·ªÅ Nix, 

T·ª´ khi s·ª≠ d·ª•ng Nix, t·ªõ ƒë√£ c√≥ th·ªÉ b·ªè ho√†n to√†n vi·ªác s·ª≠ d·ª•ng c√°c l·ªánh tr·ª±c ti·∫øp v·ªõi Homebrew qua terminal (`brew install ______`). Thay v√†o ƒë√≥, t·ªõ c√≥ th·ªÉ define nh∆∞ sau:

```jsx
{config, pkgs, lib, ...}: {
    homebrew = {
        enable = true;
        global = {
            autoUpdate = false;

        };
        
        brews = [
            "git"
            "starship"
            "borders"
            "fswatch"
        ];

        casks = [
            "iterm2" #shell
            "aldente" #battery stuff
            "macfuse" # fs utils
            "karabiner-elements" #vimmy movement
            "hiddenbar" # j4f
            "obs" # why not?

        taps = [
          "homebrew/bundle"
          "homebrew/cask-fonts"
          "homebrew/services"
          "FelixKratz/formulae"  
        ];
    };
}
```

Vi·ªác n√†y c≈©ng l√†m cho t·ªõ d·ªÖ qu·∫£n l√Ω h·ªá th·ªëng v√† package h∆°n, thay v√¨ c√†i ƒë·∫∑t d·∫ßn c√°c package khi c√†i l·∫°i h·ªá ƒëi·ªÅu h√†nh, th√¨ t·ªõ ch·ªâ c·∫ßn pull c·∫•u h√¨nh c·ªßa m√¨nh ƒë·ªÉ tr√™n Git v·ªÅ, v√† th·ª±c hi·ªán build v√† switch c·∫•u h√¨nh l√† ƒë√£ xong r·ªìi. 

Nix c√≤n gi√∫p t·ªõ qu·∫£n l√Ω c√°c package t·ªët h∆°n, tr∆∞·ªõc h·∫øt, b·∫°n h√£y nh√¨n th·ª≠ folder sau nh√©:

```jsx
$ ls -lah /nix/store | head -7
total 111456
drwxrwxr-t@ 4516 root  nixbld   141K Mar 16 13:05 .
drwxr-xr-x     9 root  wheel    288B Mar 16 11:15 ..
drwxr-xr-x  1694 root  wheel     53K Mar 16 13:05 .links
dr-xr-xr-x     3 root  nixbld    96B Jan  1  1970 007fsdh8i9nks8fpjysa638mf7sb7a4l-libffi-3.4.6
-r--r--r--     1 root  nixbld   3.1K Jan  1  1970 007pmin3326hzdncwfbarjwxfm954gy8-xar-1.6.1.drv
dr-xr-xr-x     4 root  nixbld   128B Jan  1  1970 00b3x0f87anldfr78f4xdhncqwlhpj2q-python3.11-pynvim-0.5.0
```

Nh√¨n c√°ch Nix ƒë·∫∑t t√™n folder nh∆∞ v·∫≠y, c√≥ th·ªÉ b·∫°n s·∫Ω c·∫£m th·∫•y n√≥ ho√†n to√†n v√¥ nghƒ©a, nh∆∞ng n√≥ ƒë√£ gi√∫p m√¨nh r·∫•t nhi·ªÅu trong vi·ªác qu·∫£n l√Ω c√°c package trong h·ªá th·ªëng, thay v√¨ ƒë·ªÉ binary trong `/bin` , th√¨ Nix s·∫Ω th·ª±c hi·ªán vi·ªác symlink t·ª´ `/nix/store` t·ªõi `/bin/___`, ƒëi·ªÅu n√†y kh√¥ng ch·ªâ gi√∫p m√¨nh qu·∫£n l√Ω package d·ªÖ h∆°n, m√† c√≤n gi√∫p m√¨nh m·ªói khi c·∫ßn build m·ªôt package m·ªõi 

## 3. H·ªçc Nix c√≥ kh√≥ kh√¥ng?

Nix kh√¥ng ch·ªâ l√† m·ªôt package manager, m√† Nix c√≤n l√† m·ªôt ng√¥n ng·ªØ l·∫≠p tr√¨nh, b·∫°n c√≥ th·ªÉ t∆∞·ªüng t∆∞·ª£ng n√≥ ki·ªÉu JSON nh∆∞ng h·ªó tr·ª£ function v√† link t·ª´ file n√†y, qua file kh√°c (`module`), Nix c√≥ syntaax kh√° gi·ªëng c√°c ng√¥n ng·ªØ ML (`SML`, `OCaml`, `Haskell`)

B·∫£n th√¢n m√¨nh s·ª≠ d·ª•ng NixOS ƒë∆∞·ª£c m·ªôt nƒÉm r·ªìi, v√† sau m·ªôt nƒÉm ·∫•y, m√¨nh c≈©ng ƒë√£ t·ª± vi·∫øt ƒë∆∞·ª£c cho m√¨nh nh·ªØng package custom, cho n√™n m√¨nh c≈©ng kh√¥ng nghƒ© vi·ªác l√†m ch·ªß Nix th·ª±c s·ª± qu√° kh√≥. B·∫°n s·∫Ω th·ª±c s·ª± th·∫•y Nix ƒë√°ng s·ª≠ d·ª•ng t·∫°i t√≠nh m·ªü r·ªông v√† reproducible c·ªßa n√≥.

B√†i vi·∫øt n√†y ho√†n to√†n l√† chia s·∫ª c√° nh√¢n c·ªßa m√¨nh, n·∫øu b·∫°n th·∫•y g√¨ kh√¥ng h·ª£p l√Ω ho·∫∑c sai, th√¨ h√£y comment d∆∞·ªõi b√†i vi·∫øt n√†y nh√©, m√¨nh xin c·∫£m ∆°n ·∫°! üòΩ

Tham kh·∫£o dotfiles c·ªßa m√¨nh t·∫°i: 

[GitHub - emladevops/.dotfiles-nix: Darwin Nix config](https://github.com/emladevops/.dotfiles-nix?tab=readme-ov-file)